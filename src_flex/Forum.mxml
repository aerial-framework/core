<?xml version="1.0" encoding="utf-8"?>
<s:WindowedApplication xmlns:fx="http://ns.adobe.com/mxml/2009" 
					   xmlns:s="library://ns.adobe.com/flex/spark" 
					   xmlns:mx="library://ns.adobe.com/flex/mx"
					   xmlns:services="model.services.*"
					   xmlns:view="com.forum.view.*"  applicationComplete="init()"
					  >
					   
	<fx:Declarations  >
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
	
	
	<fx:Script>
		<![CDATA[
			import com.forum.event.LoginEvent;
			
			import model.services.UserSpecialtyService;
			import model.vo.*;
			
			import mx.controls.Alert;
			import mx.core.Container;
			import mx.messaging.messages.RemotingMessage;
			import mx.rpc.events.FaultEvent;
			import mx.rpc.events.ResultEvent;
			
			private function init():void
			{
				WindowStuff();
				this.addEventListener(LoginEvent.LOGIN_ACTION, loginHandler);
				this.addEventListener(LoginEvent.LOGOUT_ACTION, loginHandler);
			}
			
			public function WindowStuff():void
			{
				this.width = 1200;
				this.height = 800;
				
				nativeWindow.x = Screen.screens[1].bounds.x + 1;
				nativeWindow.y = Screen.mainScreen.bounds.height - height - 100;
				nativeWindow.maximize();
				
				nativeWindow.alwaysInFront = true;
				nativeWindow.orderToFront();
				
				var specialty:SpecialtyVO = new SpecialtyVO();
				specialty.name = "Anthropology";
				specialty.description = "They used to love smelling feet, back in the time before christ...";
				
				var user:UserVO = new UserVO();
				user.id = 1;
				
				var us:UserSpecialtyVO = new UserSpecialtyVO();
				us.Specialty = specialty;
				us.User = user;
				
				var uss:UserSpecialtyService = new UserSpecialtyService();
				uss.addEventListener(ResultEvent.RESULT, resultHandler);
				uss.addEventListener(FaultEvent.FAULT, faultHandler);
				uss.save(us);
			}

			private function resultHandler(event:ResultEvent):void
			{
				trace(event.result);
			}
			
			public function loginHandler(e:LoginEvent):void
			{
				if(e.type == LoginEvent.LOGIN_ACTION){
					if(e.authenticated){
						this.dashboardView.user = UserVO(e.user);
						this.loginViewStack.selectedChild = Container(this.loginViewStack.getChildByName("dashboardView"));
					}else{
						Alert.show("Login Failed!");
					}
				}else if(e.type == LoginEvent.LOGOUT_ACTION){
					this.loginViewStack.selectedChild = Container(this.loginViewStack.getChildByName("loginView"));
				}
			}
			
			
			protected function faultHandler(event:FaultEvent):void
			{
				Alert.show(event.fault.faultString);
			}
		]]>
	</fx:Script>
	
	
	
	
	<mx:ViewStack id="loginViewStack" left="0" right="0" top="0" bottom="0">
		<view:Login id="loginView" />
		<view:Dashboard id="dashboardView" />
	</mx:ViewStack>
	
</s:WindowedApplication>
